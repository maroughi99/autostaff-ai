(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[600],{23318:function(e,t,a){Promise.resolve().then(a.bind(a,92983))},92983:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var s=a(27573),n=a(7653),r=a(79217),i=a(30999),l=a(60044),d=a(90747),o=a(88151),c=a(66120),u=a(61541);function m(){let{user:e}=(0,r.aF)(),[t,a]=(0,n.useState)([]),[m,f]=(0,n.useState)(!0),[x,p]=(0,n.useState)("all"),[h,g]=(0,n.useState)(null),[v,j]=(0,n.useState)(!1),[b,y]=(0,n.useState)(""),[N,w]=(0,n.useState)("cash"),[C,k]=(0,n.useState)(""),[D,R]=(0,n.useState)("");(0,n.useEffect)(()=>{e&&F()},[e,x]);let F=async()=>{try{let t="all"===x?"/api/invoices?userId=".concat(null==e?void 0:e.id):"/api/invoices?userId=".concat(null==e?void 0:e.id,"&status=").concat(x),s=await fetch(t);if(s.ok){let e=await s.json();a(e)}}catch(e){console.error("Failed to load invoices:",e)}finally{f(!1)}},S=e=>(0,s.jsx)(l.C,{className:{draft:"bg-gray-500",sent:"bg-blue-500",paid:"bg-green-500",partial:"bg-yellow-500",overdue:"bg-red-500",cancelled:"bg-gray-700"}[e]||"bg-gray-500",children:e.toUpperCase()}),z=async e=>{try{(await fetch("/api/invoices/".concat(e,"/send"),{method:"POST"})).ok?(alert("Invoice sent successfully!"),F()):alert("Failed to send invoice")}catch(e){console.error("Failed to send invoice:",e),alert("Failed to send invoice")}},O=async()=>{if(h&&b){j(!0);try{(await fetch("/api/invoices/".concat(h.id,"/record-payment"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:parseFloat(b),method:N,reference:C||void 0,notes:D||void 0})})).ok?(alert("Payment recorded successfully!"),g(null),y(""),w("cash"),k(""),R(""),F()):alert("Failed to record payment")}catch(e){console.error("Failed to record payment:",e),alert("Failed to record payment")}finally{j(!1)}}},P=async(e,t)=>{try{let a=await fetch("/api/invoices/".concat(e,"/pdf"));if(a.ok){let e=await a.blob(),s=window.URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download="invoice-".concat(t,".pdf"),document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(s),document.body.removeChild(n)}}catch(e){console.error("Failed to download PDF:",e)}},I=t.reduce((e,t)=>e+t.total,0),Z=t.reduce((e,t)=>e+t.amountPaid,0),$=t.reduce((e,t)=>e+t.amountDue,0);return m?(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)("p",{children:"Loading invoices..."})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex justify-between items-center",children:(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Billing & Invoices"})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{className:"text-sm font-medium",children:"Total Revenue"})}),(0,s.jsx)(i.aY,{children:(0,s.jsxs)("p",{className:"text-2xl font-bold",children:["$",I.toFixed(2)]})})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{className:"text-sm font-medium",children:"Amount Collected"})}),(0,s.jsx)(i.aY,{children:(0,s.jsxs)("p",{className:"text-2xl font-bold text-green-600",children:["$",Z.toFixed(2)]})})]}),(0,s.jsxs)(i.Zb,{children:[(0,s.jsx)(i.Ol,{children:(0,s.jsx)(i.ll,{className:"text-sm font-medium",children:"Outstanding"})}),(0,s.jsx)(i.aY,{children:(0,s.jsxs)("p",{className:"text-2xl font-bold text-red-600",children:["$",$.toFixed(2)]})})]})]}),(0,s.jsx)("div",{className:"flex gap-2",children:["all","draft","sent","partial","paid","overdue"].map(e=>(0,s.jsx)(d.z,{variant:x===e?"default":"outline",onClick:()=>p(e),children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,s.jsx)("div",{className:"space-y-4",children:0===t.length?(0,s.jsx)(i.Zb,{children:(0,s.jsx)(i.aY,{className:"py-8 text-center text-gray-500",children:"No invoices found"})}):t.map(e=>(0,s.jsx)(i.Zb,{children:(0,s.jsx)(i.aY,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-lg",children:e.invoiceNumber}),S(e.status)]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,s.jsx)("strong",{children:e.lead.name})," • ",e.lead.email]}),(0,s.jsx)("p",{className:"font-medium mb-2",children:e.title}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-500",children:"Issue Date"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(e.issueDate).toLocaleDateString()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-500",children:"Due Date"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(e.dueDate).toLocaleDateString()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-500",children:"Total Amount"}),(0,s.jsxs)("p",{className:"font-medium",children:["$",e.total.toFixed(2)]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-500",children:"Amount Due"}),(0,s.jsxs)("p",{className:"font-medium ".concat(e.amountDue>0?"text-red-600":"text-green-600"),children:["$",e.amountDue.toFixed(2)]})]})]}),(0,s.jsxs)("div",{className:"border-t pt-3",children:[(0,s.jsx)("p",{className:"text-sm font-medium mb-2",children:"Items:"}),e.items.map(e=>(0,s.jsxs)("div",{className:"text-sm text-gray-600 flex justify-between",children:[(0,s.jsxs)("span",{children:[e.quantity,"x ",e.description]}),(0,s.jsxs)("span",{children:["$",e.total.toFixed(2)]})]},e.id))]}),e.payments.length>0&&(0,s.jsxs)("div",{className:"border-t mt-3 pt-3",children:[(0,s.jsx)("p",{className:"text-sm font-medium mb-2",children:"Payment History:"}),e.payments.map(e=>(0,s.jsxs)("div",{className:"text-sm text-gray-600 flex justify-between",children:[(0,s.jsxs)("span",{children:[new Date(e.paymentDate).toLocaleDateString()," •"," ",e.method,e.reference&&" (".concat(e.reference,")")]}),(0,s.jsxs)("span",{className:"text-green-600 font-medium",children:["+$",e.amount.toFixed(2)]})]},e.id))]})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 ml-4",children:["draft"===e.status&&(0,s.jsx)(d.z,{size:"sm",onClick:()=>z(e.id),children:"Send Invoice"}),e.amountDue>0&&(0,s.jsxs)(o.Vq,{children:[(0,s.jsx)(o.hg,{asChild:!0,children:(0,s.jsx)(d.z,{size:"sm",variant:"outline",onClick:()=>{g(e),y(e.amountDue.toString())},children:"Record Payment"})}),(0,s.jsxs)(o.cZ,{children:[(0,s.jsx)(o.fK,{children:(0,s.jsxs)(o.$N,{children:["Record Payment - ",e.invoiceNumber]})}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Amount"}),(0,s.jsx)(c.I,{type:"number",step:"0.01",value:b,onChange:e=>y(e.target.value),placeholder:"0.00"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Payment Method"}),(0,s.jsxs)("select",{className:"w-full border rounded p-2",value:N,onChange:e=>w(e.target.value),children:[(0,s.jsx)("option",{value:"cash",children:"Cash"}),(0,s.jsx)("option",{value:"check",children:"Check"}),(0,s.jsx)("option",{value:"credit_card",children:"Credit Card"}),(0,s.jsx)("option",{value:"bank_transfer",children:"Bank Transfer"}),(0,s.jsx)("option",{value:"other",children:"Other"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Reference/Check Number"}),(0,s.jsx)(c.I,{value:C,onChange:e=>k(e.target.value),placeholder:"Optional"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Notes"}),(0,s.jsx)(u.g,{value:D,onChange:e=>R(e.target.value),placeholder:"Optional payment notes"})]}),(0,s.jsx)(d.z,{className:"w-full",onClick:O,disabled:v||!b,children:v?"Recording...":"Record Payment"})]})]})]}),(0,s.jsx)(d.z,{size:"sm",variant:"ghost",onClick:()=>P(e.id,e.invoiceNumber),children:"Download PDF"})]})]})})},e.id))})]})}},60044:function(e,t,a){"use strict";a.d(t,{C:function(){return l}});var s=a(27573);a(7653);var n=a(69484),r=a(33061);let i=(0,n.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:a,...n}=e;return(0,s.jsx)("div",{className:(0,r.cn)(i({variant:a}),t),...n})}},90747:function(e,t,a){"use strict";a.d(t,{z:function(){return o}});var s=a(27573),n=a(7653),r=a(50432),i=a(69484),l=a(33061);let d=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef((e,t)=>{let{className:a,variant:n,size:i,asChild:o=!1,...c}=e,u=o?r.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(d({variant:n,size:i,className:a})),ref:t,...c})});o.displayName="Button"},30999:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},Zb:function(){return i},aY:function(){return o},ll:function(){return d}});var s=a(27573),n=a(7653),r=a(33061);let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...n})});i.displayName="Card";let l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",a),...n})});l.displayName="CardHeader";let d=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("h3",{ref:t,className:(0,r.cn)("text-2xl font-semibold leading-none tracking-tight",a),...n})});d.displayName="CardTitle",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("p",{ref:t,className:(0,r.cn)("text-sm text-muted-foreground",a),...n})}).displayName="CardDescription";let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("p-6 pt-0",a),...n})});o.displayName="CardContent",n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("div",{ref:t,className:(0,r.cn)("flex items-center p-6 pt-0",a),...n})}).displayName="CardFooter"},88151:function(e,t,a){"use strict";a.d(t,{$N:function(){return x},Be:function(){return p},Vq:function(){return d},cZ:function(){return m},fK:function(){return f},hg:function(){return o}});var s=a(27573),n=a(7653),r=a(87245),i=a(57342),l=a(33061);let d=r.fC,o=r.xz,c=r.h_;r.x8;let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.aV,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n})});u.displayName=r.aV.displayName;let m=n.forwardRef((e,t)=>{let{className:a,children:n,...d}=e;return(0,s.jsxs)(c,{children:[(0,s.jsx)(u,{}),(0,s.jsxs)(r.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[n,(0,s.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=r.VY.displayName;let f=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};f.displayName="DialogHeader";let x=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",a),...n})});x.displayName=r.Dx.displayName;let p=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)(r.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",a),...n})});p.displayName=r.dk.displayName},66120:function(e,t,a){"use strict";a.d(t,{I:function(){return i}});var s=a(27573),n=a(7653),r=a(33061);let i=n.forwardRef((e,t)=>{let{className:a,type:n,...i}=e;return(0,s.jsx)("input",{type:n,className:(0,r.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...i})});i.displayName="Input"},61541:function(e,t,a){"use strict";a.d(t,{g:function(){return i}});var s=a(27573),n=a(7653),r=a(33061);let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,s.jsx)("textarea",{className:(0,r.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...n})});i.displayName="Textarea"},33061:function(e,t,a){"use strict";a.d(t,{cn:function(){return r}});var s=a(90794),n=a(59654);function r(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,s.W)(t))}}},function(e){e.O(0,[217,832,498,293,16,744],function(){return e(e.s=23318)}),_N_E=e.O()}]);